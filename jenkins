pipeline {
    agent any

    stages {
        stage('Checkout') {
            steps {
                // Checkout code from the linked GitHub repository
                git url: 'YOUR_GITHUB_REPO_URL', branch: 'main'
            }
        }
        
        stage('Install Dependencies') {
            steps {
                // Assuming Python and 'pip' are available on the Jenkins agent
                sh 'pip install -r requirements.txt' // If you have a requirements file
            }
        }
        
        stage('Test Code') {
            steps {
                // Run the Python unit tests
                // The '-v' flag shows verbose output, crucial for submission Task 5
                sh 'python -m unittest test_app.py -v' 
            }
        }
    }
    
    post {
        // Always run this section to send the notification
        always {
            script {
                // Determine the build status
                def buildStatus = currentBuild.result ?: 'SUCCESS'
                def webexRoomId = 'YOUR_WEBEX_SPACE_ID_OR_NAME'
                
                // Construct the message
                def message = "ðŸš¨ **Jenkins Build Alert** ðŸš¨\n" +
                              "**Project:** ${env.JOB_NAME}\n" +
                              "**Build Number:** ${env.BUILD_NUMBER}\n" +
                              "**Status:** ${buildStatus}\n" +
                              "**URL:** ${env.BUILD_URL}\n" +
                              "**Commit:** ${sh(returnStdout: true, script: 'git rev-parse --short HEAD').trim()}"
                              
                // Use the WebEx Notification plugin step (syntax may vary by plugin version)
                // This is a conceptual step; refer to the plugin's documentation for exact syntax.
                webexSend(room: webexRoomId, message: message)
            }
        }
    }
}
